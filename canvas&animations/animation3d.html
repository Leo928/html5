<!DOCTYPE html>
<html lang="en">

<head>
  <title>three.js动画效果</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      color: #808080;
      font-family: monospace;
      font-size: 13px;
      text-align: center;
      background-color: #f0f0f0;
      margin: 0px;
      overflow: hidden;
    }

    a {
      color: #0080ff;
    }

    b {
      color: lightgreen;
    }

    #container {
      white-space: nowrap;
    }

    #container_logzbuf {
      width: 50%;
      display: inline-block;
      position: relative;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="container_logzbuf">
    </div>
  </div>
  <script src="../vendor/three.js-dev/three.js-dev/three.js"></script>
  <script src="../vendor/three.js-dev/three.js-dev/stats.min.js"></script>
  <script src="../vendor/three.js-dev/three.js-dev/TrackballControls.js"></script>
  <script>
    var view = {};
    var controls;
    var FOV = 50,
      NEAR = 0.1,
      FAR = 50000;
    var SCREEN_WIDTH = window.innerWidth;
    var SCREEN_HEIGHT = window.innerHeight;
    var labeldata = [{
        label: "艾斯",
        imgurl: "../img/imgs/ace.jpg",
        position: [0, 40 - FOV, 0],
        size: [50, 80, 10]
      },
      {
        label: "马歇尔·D·蒂奇",
        imgurl: "../img/imgs/teach.jpg",
        position: [-120, 75 - FOV, 500],
        size: [90, 160, 10]
      },
      {
        label: '唐吉诃德·多弗朗明哥',
        imgurl: '../img/imgs/doflamingo.jpg',
        position: [120, 90 - FOV, 500],
        size: [90, 160, 10]
      },
      {
        label: '波雅·汉库克',
        imgurl: '../img/imgs/hancock.jpg',
        position: [-120, 45 - FOV, 1000],
        size: [50, 90, 10]
      },
      {
        label: '月光·莫利亚',
        imgurl: '../img/imgs/moria.jpg',
        position: [120, 90 - FOV, 1000],
        size: [120, 180, 20]
      },
      {
        label: '乔拉可尔·米霍克',
        imgurl: '../img/imgs/mihawk.jpg',
        position: [-120, 50 - FOV, 1500],
        size: [50, 100, 10]
      },
      {
        label: '巴索罗米·熊',
        imgurl: '../img/imgs/kuma.jpg',
        position: [120, 75 - FOV, 1500],
        size: [140, 150, 10]
      },
      {
        label: '沙·克洛克达尔',
        imgurl: '../img/imgs/crocodile.jpg',
        position: [-120, 55 - FOV, 2000],
        size: [60, 110, 10]
      },
      {
        label: '甚平',
        imgurl: '../img/imgs/jinbe.jpg',
        position: [120, 50 - FOV, 2000],
        size: [70, 100, 10]
      }
    ];
    var textureLoader = new THREE.TextureLoader();

    init();

    function init() {
      var scene = initScene();
      view = initView(scene);
      controls = new THREE.TrackballControls(view.camera);
      animate();
    }

    function initScene() {
      var scene = new THREE.Scene();
      scene.add(new THREE.AmbientLight(0x3f2806));

      var light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(0, 100, 100);
      scene.add(light);

      var textureSquares = textureLoader.load("../img/imgs/bright_squares256.png");
      textureSquares.repeat.set(10, 10);
      textureSquares.wraps = textureSquares.wrapT = THREE.RepeatWrapping;
      textureSquares.mapFilter=THREE.NearestFilter;
      textureSquares.format=THREE.RGBFormat;

      var groundMaterial =new THREE.MeshPhongMaterial({
        shininess:80,
        color:0xffffff,
        specular:0xffffff,
        map:textureSquares
      });

      var planeGeometry=new THREE.PlaneBufferGeometry(100,100);
      var ground=new THREE.Mesh(planeGeometry,groundMaterial);
      ground.position.set(0,-FOV,0);
      ground.rotation.x=-Math.PI/2;
      ground.scale.set(1000,1000,1000);
      ground.receiveShadow=true;
      scene.add(ground);


      labeldata.forEach(function(item){
        textureLoader.load(item.imgurl,function(texture){
          var geometry=new THREE.BoxBufferGeometry(item.size[0],item.size[1],item.size[2]);
          var material=new THREE.MeshLambertMaterial({
            map:texture
          });
          var dotmesh=new THREE.Mesh(geometry,material);
          dotmesh.position.set(item.position[0],item.position[1],item.position[2]);
          scene.add(dotmesh);
        });
      });
      return scene;
    }

    function initView(scene){
      var framecontainer=document.getElementById("container_logzbuf");
      var camera=new THREE.PerspectiveCamera(FOV,SCREEN_WIDTH/SCREEN_HEIGHT,NEAR,FAR);
      camera.position.set(0,0,300);
      scene.add(camera);

      var renderer=new THREE.WebGLRenderer({antialias:true,logarithmicDepthBuffer:true});

      renderer.setClearColor(0xf0f0f0);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(SCREEN_WIDTH/2,SCREEN_HEIGHT);
      renderer.domElement.style.position='relative';
      renderer.domElement.id="renderer_logzbuf";

      framecontainer.appendChild(renderer.domElement);

      return{
        container:framecontainer,
        renderer:renderer,
        scene:scene,
        camera:camera
      };
    }

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      render();
    }

    function render(){
      updateRendererSize();
      view.renderer.render(view.scene,view.camera);
    }

    function updateRendererSize(){
      SCREEN_WIDTH=window.innerWidth;
      SCREEN_HEIGHT=window.innerHeight;
      
      view.renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT);
      view.camera.aspect=SCREEN_WIDTH/SCREEN_HEIGHT;
      view.camera.updateProjectionMatrix();
      view.camera.setViewOffset(SCREEN_WIDTH,SCREEN_HEIGHT,0,0,SCREEN_WIDTH,SCREEN_HEIGHT);
      view.container.style.width=100+"%";
    }
  </script>
</body>

</html>